<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .editor-container { background: rgba(255, 255, 255, 0.95); }
        .dark .editor-container { background: rgba(30, 27, 75, 0.95); }
        .preview { overflow-y: auto; padding: 1rem; }
        .preview h1 { font-size: 2em; font-weight: bold; margin: 0.5em 0; }
        .preview h2 { font-size: 1.5em; font-weight: bold; margin: 0.5em 0; }
        .preview h3 { font-size: 1.17em; font-weight: bold; margin: 0.5em 0; }
        .preview p { margin: 1em 0; }
        .preview ul, .preview ol { margin: 1em 0; padding-left: 2em; }
        .preview code { background: #f4f4f4; padding: 0.2em 0.4em; border-radius: 3px; font-family: monospace; }
        .preview pre { background: #f4f4f4; padding: 1em; border-radius: 5px; overflow-x: auto; }
        .preview pre code { background: none; padding: 0; }
        .preview table { border-collapse: collapse; width: 100%; margin: 1em 0; }
        .preview th, .preview td { border: 1px solid #ddd; padding: 0.5em; }
        .preview th { background: #f4f4f4; font-weight: bold; }
        .preview a { color: #667eea; text-decoration: underline; }
        .preview blockquote { border-left: 4px solid #667eea; padding-left: 1em; margin: 1em 0; color: #666; }
        .dark .preview code, .dark .preview pre { background: #2d3748; color: #e2e8f0; }
        .dark .preview th { background: #2d3748; }
        .dark .preview a { color: #a78bfa; }
    </style>
</head>
<body class="min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
        <div class="mb-4 flex items-center justify-between">
            <a href="../" class="text-white hover:text-purple-200 transition"><i class="fas fa-arrow-left mr-2"></i>Back</a>
            <h1 class="text-3xl font-bold text-white"><i class="fas fa-markdown mr-2"></i>Markdown Editor</h1>
            <button id="darkToggle" class="text-white hover:text-purple-200 transition"><i class="fas fa-moon"></i></button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-lg p-4 text-white">
                <i class="fas fa-file-alt text-2xl mb-2"></i>
                <div class="text-sm opacity-80">Documents</div>
                <div class="text-2xl font-bold" id="docCount">1</div>
            </div>
            <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-lg p-4 text-white">
                <i class="fas fa-keyboard text-2xl mb-2"></i>
                <div class="text-sm opacity-80">Characters</div>
                <div class="text-2xl font-bold" id="charCount">0</div>
            </div>
            <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-lg p-4 text-white">
                <i class="fas fa-align-left text-2xl mb-2"></i>
                <div class="text-sm opacity-80">Words</div>
                <div class="text-2xl font-bold" id="wordCount">0</div>
            </div>
        </div>

        <div class="editor-container rounded-lg shadow-2xl p-4 mb-4">
            <div class="flex flex-wrap gap-2 mb-4 items-center">
                <select id="docSelector" class="px-3 py-2 rounded border border-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500"></select>
                <button id="newDoc" class="px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition"><i class="fas fa-plus mr-1"></i>New</button>
                <button id="renameDoc" class="px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition"><i class="fas fa-edit mr-1"></i>Rename</button>
                <button id="deleteDoc" class="px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition"><i class="fas fa-trash mr-1"></i>Delete</button>
                <button id="download" class="px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition"><i class="fas fa-download mr-1"></i>Download</button>
            </div>

            <div class="flex flex-wrap gap-2 mb-4 border-b pb-3">
                <button data-md="# " class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 transition" title="Heading 1"><i class="fas fa-heading"></i>1</button>
                <button data-md="## " class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 transition" title="Heading 2"><i class="fas fa-heading"></i>2</button>
                <button data-md="**" data-wrap="true" class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 transition" title="Bold"><i class="fas fa-bold"></i></button>
                <button data-md="*" data-wrap="true" class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 transition" title="Italic"><i class="fas fa-italic"></i></button>
                <button data-md="`" data-wrap="true" class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 transition" title="Code"><i class="fas fa-code"></i></button>
                <button data-md="- " class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 transition" title="List"><i class="fas fa-list-ul"></i></button>
                <button data-md="1. " class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 transition" title="Numbered List"><i class="fas fa-list-ol"></i></button>
                <button data-md="[]()" data-link="true" class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 transition" title="Link"><i class="fas fa-link"></i></button>
                <button data-md="> " class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 transition" title="Quote"><i class="fas fa-quote-right"></i></button>
                <button data-table="true" class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 transition" title="Table"><i class="fas fa-table"></i></button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div>
                    <h3 class="font-semibold mb-2 text-purple-700 dark:text-purple-300">Editor</h3>
                    <textarea id="editor" class="w-full h-96 p-4 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 font-mono text-sm dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600" placeholder="Start typing markdown..."></textarea>
                </div>
                <div>
                    <h3 class="font-semibold mb-2 text-purple-700 dark:text-purple-300">Preview</h3>
                    <div id="preview" class="preview w-full h-96 border border-purple-300 rounded-lg bg-white dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const editor = document.getElementById('editor');
        const preview = document.getElementById('preview');
        const docSelector = document.getElementById('docSelector');
        const darkToggle = document.getElementById('darkToggle');
        const charCount = document.getElementById('charCount');
        const wordCount = document.getElementById('wordCount');
        const docCount = document.getElementById('docCount');

        let docs = JSON.parse(localStorage.getItem('mdDocs')) || { 'Untitled': '' };
        let currentDoc = localStorage.getItem('mdCurrent') || 'Untitled';
        let isDark = localStorage.getItem('mdDark') === 'true';

        if (isDark) document.documentElement.classList.add('dark');

        function updateDocs() {
            docSelector.innerHTML = '';
            Object.keys(docs).forEach(name => {
                const opt = document.createElement('option');
                opt.value = name;
                opt.textContent = name;
                docSelector.appendChild(opt);
            });
            docSelector.value = currentDoc;
            docCount.textContent = Object.keys(docs).length;
        }

        function saveDoc() {
            docs[currentDoc] = editor.value;
            localStorage.setItem('mdDocs', JSON.stringify(docs));
            localStorage.setItem('mdCurrent', currentDoc);
        }

        function loadDoc() {
            editor.value = docs[currentDoc] || '';
            updatePreview();
        }

        function updatePreview() {
            preview.innerHTML = marked.parse(editor.value || '_Start typing to see preview..._');
            const text = editor.value;
            charCount.textContent = text.length;
            wordCount.textContent = text.trim().split(/\s+/).filter(w => w).length;
        }

        editor.addEventListener('input', () => {
            saveDoc();
            updatePreview();
        });

        docSelector.addEventListener('change', () => {
            currentDoc = docSelector.value;
            loadDoc();
        });

        document.getElementById('newDoc').addEventListener('click', () => {
            const name = prompt('Document name:');
            if (name && !docs[name]) {
                docs[name] = '';
                currentDoc = name;
                updateDocs();
                loadDoc();
                saveDoc();
            }
        });

        document.getElementById('renameDoc').addEventListener('click', () => {
            const name = prompt('New name:', currentDoc);
            if (name && name !== currentDoc && !docs[name]) {
                docs[name] = docs[currentDoc];
                delete docs[currentDoc];
                currentDoc = name;
                updateDocs();
                saveDoc();
            }
        });

        document.getElementById('deleteDoc').addEventListener('click', () => {
            if (Object.keys(docs).length === 1) return alert('Cannot delete last document!');
            if (confirm(`Delete "${currentDoc}"?`)) {
                delete docs[currentDoc];
                currentDoc = Object.keys(docs)[0];
                updateDocs();
                loadDoc();
                saveDoc();
            }
        });

        document.getElementById('download').addEventListener('click', () => {
            const blob = new Blob([editor.value], { type: 'text/markdown' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = currentDoc + '.md';
            a.click();
        });

        darkToggle.addEventListener('click', () => {
            isDark = !isDark;
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('mdDark', isDark);
            darkToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        });

        document.querySelectorAll('[data-md]').forEach(btn => {
            btn.addEventListener('click', () => {
                const start = editor.selectionStart;
                const end = editor.selectionEnd;
                const selected = editor.value.substring(start, end);
                const md = btn.dataset.md;

                if (btn.dataset.wrap) {
                    editor.value = editor.value.substring(0, start) + md + selected + md + editor.value.substring(end);
                    editor.selectionStart = editor.selectionEnd = start + md.length + selected.length + md.length;
                } else if (btn.dataset.link) {
                    const text = selected || 'text';
                    editor.value = editor.value.substring(0, start) + `[${text}](url)` + editor.value.substring(end);
                    editor.selectionStart = start + text.length + 3;
                    editor.selectionEnd = start + text.length + 6;
                } else if (btn.dataset.table) {
                    const table = '\n| Header 1 | Header 2 |\n|----------|----------|\n| Cell 1   | Cell 2   |\n';
                    editor.value = editor.value.substring(0, end) + table + editor.value.substring(end);
                    editor.selectionStart = editor.selectionEnd = end + table.length;
                } else {
                    const lineStart = editor.value.lastIndexOf('\n', start - 1) + 1;
                    editor.value = editor.value.substring(0, lineStart) + md + editor.value.substring(lineStart);
                    editor.selectionStart = editor.selectionEnd = start + md.length;
                }
                editor.focus();
                saveDoc();
                updatePreview();
            });
        });

        updateDocs();
        loadDoc();
        darkToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    </script>
</body>
</html>
