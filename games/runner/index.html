<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>쿠키런 스타일 러너</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        canvas {
            display: block;
            background: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 50%, #90EE90 100%);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .game-container {
            position: relative;
        }

        .game-ui {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            z-index: 10;
            pointer-events: none;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-weight: bold;
            font-size: 18px;
        }

        .modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            text-align: center;
            z-index: 100;
            min-width: 350px;
        }

        .btn {
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
        }

        .score-large {
            font-size: 48px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
        }

        .new-record {
            color: #f5576c;
            font-weight: bold;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .instruction {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 10px 20px;
            border-radius: 15px;
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="flex items-center justify-center min-h-screen">
        <div class="game-container">
            <canvas id="gameCanvas" width="1000" height="600"></canvas>

            <div class="game-ui">
                <div class="stat-box">
                    <i class="fas fa-trophy text-yellow-500"></i> 점수: <span id="score">0</span>
                </div>
                <div class="stat-box">
                    <i class="fas fa-road text-blue-500"></i> 거리: <span id="distance">0</span>m
                </div>
                <div class="stat-box">
                    <i class="fas fa-coins text-yellow-400"></i> 코인: <span id="coins">0</span>
                </div>
                <div class="stat-box">
                    <i class="fas fa-crown text-purple-500"></i> 최고: <span id="highScore">0</span>
                </div>
            </div>

            <div id="startModal" class="modal">
                <h1 class="text-4xl font-bold mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    쿠키 러너 게임
                </h1>
                <p class="text-gray-600 text-lg mb-4">신나는 무한 달리기 게임!</p>
                <div class="instruction">
                    <i class="fas fa-keyboard"></i> 스페이스바 또는 클릭으로 점프
                </div>
                <div class="instruction">
                    <i class="fas fa-exclamation-triangle"></i> 장애물을 피하세요
                </div>
                <div class="instruction">
                    <i class="fas fa-coins"></i> 코인을 모으세요
                </div>
                <button class="btn btn-primary" onclick="startGame()">
                    <i class="fas fa-play"></i> 게임 시작
                </button>
            </div>

            <div id="gameOverModal" class="modal" style="display: none;">
                <h2 class="text-3xl font-bold mb-4 text-gray-800">게임 오버!</h2>
                <div id="newRecordBadge" class="new-record text-2xl mb-4" style="display: none;">
                    <i class="fas fa-star"></i> 새로운 기록! <i class="fas fa-star"></i>
                </div>
                <div class="score-large" id="finalScore">0</div>
                <div class="text-gray-600 mb-2">
                    <i class="fas fa-road"></i> 거리: <span id="finalDistance">0</span>m
                </div>
                <div class="text-gray-600 mb-4">
                    <i class="fas fa-coins"></i> 코인: <span id="finalCoins">0</span>개
                </div>
                <div class="text-purple-600 font-bold text-xl mb-6">
                    <i class="fas fa-crown"></i> 최고 점수: <span id="finalHighScore">0</span>
                </div>
                <button class="btn btn-primary" onclick="restartGame()">
                    <i class="fas fa-redo"></i> 다시 하기
                </button>
                <button class="btn btn-secondary" onclick="location.reload()">
                    <i class="fas fa-home"></i> 메인으로
                </button>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Game state
        let gameRunning = false;
        let score = 0;
        let distance = 0;
        let coins = 0;
        let highScore = localStorage.getItem('cookieRunnerHighScore') || 0;
        let gameSpeed = 6;
        let gravity = 0.8;
        let frameCount = 0;

        // Player
        const player = {
            x: 100,
            y: 400,
            width: 50,
            height: 50,
            velocityY: 0,
            jumping: false,
            grounded: false
        };

        const ground = 450;

        // Arrays for game objects
        let obstacles = [];
        let collectibles = [];
        let clouds = [];
        let trees = [];

        // Initialize high score display
        document.getElementById('highScore').textContent = highScore;

        // Generate initial background elements
        function initBackground() {
            // Clouds
            for (let i = 0; i < 5; i++) {
                clouds.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * 200 + 50,
                    width: 80 + Math.random() * 40,
                    speed: 0.5 + Math.random() * 0.5
                });
            }

            // Trees
            for (let i = 0; i < 3; i++) {
                trees.push({
                    x: Math.random() * canvas.width,
                    y: ground + 10,
                    width: 40,
                    height: 80,
                    speed: gameSpeed * 0.3
                });
            }
        }

        // Draw player (cookie character)
        function drawPlayer() {
            // Body (cookie)
            ctx.fillStyle = '#D2691E';
            ctx.beginPath();
            ctx.arc(player.x + 25, player.y + 25, 25, 0, Math.PI * 2);
            ctx.fill();

            // Chocolate chips
            ctx.fillStyle = '#654321';
            ctx.beginPath();
            ctx.arc(player.x + 15, player.y + 20, 4, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(player.x + 35, player.y + 25, 4, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(player.x + 25, player.y + 35, 4, 0, Math.PI * 2);
            ctx.fill();

            // Eyes
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(player.x + 18, player.y + 22, 3, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(player.x + 32, player.y + 22, 3, 0, Math.PI * 2);
            ctx.fill();

            // Smile
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(player.x + 25, player.y + 28, 8, 0.2 * Math.PI, 0.8 * Math.PI);
            ctx.stroke();

            // Running legs animation
            if (player.grounded) {
                const legOffset = Math.sin(frameCount * 0.3) * 3;
                ctx.fillStyle = '#D2691E';
                ctx.fillRect(player.x + 15, player.y + 45, 8, 10 + legOffset);
                ctx.fillRect(player.x + 27, player.y + 45, 8, 10 - legOffset);
            }
        }

        // Draw obstacle
        function drawObstacle(obs) {
            if (obs.type === 'cactus') {
                // Cactus
                ctx.fillStyle = '#2d7d2d';
                ctx.fillRect(obs.x + 15, obs.y + 20, 20, obs.height - 20);
                ctx.fillRect(obs.x, obs.y + 30, 15, 20);
                ctx.fillRect(obs.x + 35, obs.y + 35, 15, 15);
            } else if (obs.type === 'rock') {
                // Rock
                ctx.fillStyle = '#696969';
                ctx.beginPath();
                ctx.ellipse(obs.x + obs.width/2, obs.y + obs.height/2, obs.width/2, obs.height/2, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#505050';
                ctx.beginPath();
                ctx.ellipse(obs.x + obs.width/3, obs.y + obs.height/3, obs.width/4, obs.height/4, 0, 0, Math.PI * 2);
                ctx.fill();
            } else {
                // Spike
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(obs.x, obs.y + obs.height - 10, obs.width, 10);
                ctx.fillStyle = '#FF6347';
                for (let i = 0; i < 3; i++) {
                    ctx.beginPath();
                    ctx.moveTo(obs.x + i * 15 + 5, obs.y + obs.height - 10);
                    ctx.lineTo(obs.x + i * 15 + 12.5, obs.y);
                    ctx.lineTo(obs.x + i * 15 + 20, obs.y + obs.height - 10);
                    ctx.closePath();
                    ctx.fill();
                }
            }
        }

        // Draw collectible (coin)
        function drawCollectible(col) {
            const pulse = Math.sin(frameCount * 0.1) * 3;
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(col.x, col.y, 15 + pulse, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#FFA500';
            ctx.beginPath();
            ctx.arc(col.x, col.y, 10 + pulse, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('₩', col.x, col.y);
        }

        // Draw cloud
        function drawCloud(cloud) {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.beginPath();
            ctx.arc(cloud.x, cloud.y, 20, 0, Math.PI * 2);
            ctx.arc(cloud.x + 25, cloud.y, 25, 0, Math.PI * 2);
            ctx.arc(cloud.x + 50, cloud.y, 20, 0, Math.PI * 2);
            ctx.arc(cloud.x + 25, cloud.y + 15, 20, 0, Math.PI * 2);
            ctx.fill();
        }

        // Draw tree
        function drawTree(tree) {
            // Trunk
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(tree.x + 15, tree.y + 40, 10, 40);
            // Leaves
            ctx.fillStyle = '#228B22';
            ctx.beginPath();
            ctx.moveTo(tree.x + 20, tree.y);
            ctx.lineTo(tree.x, tree.y + 50);
            ctx.lineTo(tree.x + 40, tree.y + 50);
            ctx.closePath();
            ctx.fill();
            ctx.beginPath();
            ctx.moveTo(tree.x + 20, tree.y + 15);
            ctx.lineTo(tree.x + 5, tree.y + 50);
            ctx.lineTo(tree.x + 35, tree.y + 50);
            ctx.closePath();
            ctx.fill();
        }

        // Draw ground
        function drawGround() {
            // Grass
            ctx.fillStyle = '#7CFC00';
            ctx.fillRect(0, ground + 10, canvas.width, canvas.height - ground - 10);

            // Ground line
            ctx.strokeStyle = '#228B22';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, ground + 10);
            ctx.lineTo(canvas.width, ground + 10);
            ctx.stroke();

            // Ground details (moving pattern)
            ctx.fillStyle = '#90EE90';
            const offset = (frameCount * gameSpeed) % 40;
            for (let i = -1; i < canvas.width / 40 + 1; i++) {
                ctx.fillRect(i * 40 - offset, ground + 10, 20, canvas.height - ground - 10);
            }
        }

        // Update player physics
        function updatePlayer() {
            if (!player.grounded) {
                player.velocityY += gravity;
                player.y += player.velocityY;
            }

            if (player.y >= ground - player.height) {
                player.y = ground - player.height;
                player.velocityY = 0;
                player.jumping = false;
                player.grounded = true;
            } else {
                player.grounded = false;
            }
        }

        // Jump function
        function jump() {
            if (player.grounded && !player.jumping) {
                player.velocityY = -18;
                player.jumping = true;
                player.grounded = false;
            }
        }

        // Spawn obstacle
        function spawnObstacle() {
            const types = ['cactus', 'rock', 'spike'];
            const type = types[Math.floor(Math.random() * types.length)];
            const obstacle = {
                x: canvas.width,
                y: ground - 60,
                width: 50,
                height: 60,
                type: type
            };
            obstacles.push(obstacle);
        }

        // Spawn collectible
        function spawnCollectible() {
            const collectible = {
                x: canvas.width,
                y: ground - 100 - Math.random() * 150,
                width: 30,
                height: 30,
                collected: false
            };
            collectibles.push(collectible);
        }

        // Spawn cloud
        function spawnCloud() {
            clouds.push({
                x: canvas.width,
                y: Math.random() * 200 + 50,
                width: 80 + Math.random() * 40,
                speed: 0.5 + Math.random() * 0.5
            });
        }

        // Spawn tree
        function spawnTree() {
            trees.push({
                x: canvas.width,
                y: ground + 10,
                width: 40,
                height: 80,
                speed: gameSpeed * 0.3
            });
        }

        // Check collision
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // Update game objects
        function updateGame() {
            if (!gameRunning) return;

            frameCount++;

            // Update score and distance
            score += 1;
            distance = Math.floor(score / 10);

            // Increase speed gradually
            if (frameCount % 300 === 0) {
                gameSpeed += 0.5;
            }

            // Update player
            updatePlayer();

            // Update and draw background elements
            clouds = clouds.filter(cloud => {
                cloud.x -= cloud.speed;
                return cloud.x + cloud.width > -100;
            });

            trees = trees.filter(tree => {
                tree.x -= tree.speed;
                return tree.x + tree.width > -50;
            });

            // Spawn background elements
            if (Math.random() < 0.01) spawnCloud();
            if (Math.random() < 0.005) spawnTree();

            // Update obstacles
            obstacles = obstacles.filter(obs => {
                obs.x -= gameSpeed;

                // Check collision with player
                if (checkCollision(player, obs)) {
                    gameOver();
                    return false;
                }

                return obs.x + obs.width > -50;
            });

            // Update collectibles
            collectibles = collectibles.filter(col => {
                col.x -= gameSpeed;

                // Check collection
                const playerCenter = {
                    x: player.x + player.width / 2,
                    y: player.y + player.height / 2
                };
                const distance = Math.sqrt(
                    Math.pow(playerCenter.x - col.x, 2) +
                    Math.pow(playerCenter.y - col.y, 2)
                );

                if (distance < 35 && !col.collected) {
                    col.collected = true;
                    coins++;
                    score += 50;
                    document.getElementById('coins').textContent = coins;
                }

                return col.x > -30;
            });

            // Spawn new obstacles
            if (frameCount % Math.max(60, 120 - Math.floor(gameSpeed * 3)) === 0) {
                spawnObstacle();
            }

            // Spawn new collectibles
            if (frameCount % 150 === 0) {
                spawnCollectible();
            }

            // Update UI
            document.getElementById('score').textContent = score;
            document.getElementById('distance').textContent = distance;
        }

        // Draw everything
        function draw() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw sky gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(0.5, '#E0F6FF');
            gradient.addColorStop(1, '#90EE90');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw clouds
            clouds.forEach(cloud => drawCloud(cloud));

            // Draw trees
            trees.forEach(tree => drawTree(tree));

            // Draw ground
            drawGround();

            // Draw game objects
            obstacles.forEach(obs => drawObstacle(obs));
            collectibles.forEach(col => {
                if (!col.collected) drawCollectible(col);
            });

            // Draw player
            drawPlayer();
        }

        // Game loop
        function gameLoop() {
            updateGame();
            draw();
            if (gameRunning) {
                requestAnimationFrame(gameLoop);
            }
        }

        // Start game
        function startGame() {
            document.getElementById('startModal').style.display = 'none';
            gameRunning = true;
            score = 0;
            distance = 0;
            coins = 0;
            gameSpeed = 6;
            frameCount = 0;
            obstacles = [];
            collectibles = [];
            clouds = [];
            trees = [];
            player.y = ground - player.height;
            player.velocityY = 0;
            player.jumping = false;
            player.grounded = true;

            initBackground();
            document.getElementById('score').textContent = score;
            document.getElementById('distance').textContent = distance;
            document.getElementById('coins').textContent = coins;

            gameLoop();
        }

        // Game over
        function gameOver() {
            gameRunning = false;

            // Update high score
            const isNewRecord = score > highScore;
            if (isNewRecord) {
                highScore = score;
                localStorage.setItem('cookieRunnerHighScore', highScore);
                document.getElementById('highScore').textContent = highScore;
                document.getElementById('newRecordBadge').style.display = 'block';
            } else {
                document.getElementById('newRecordBadge').style.display = 'none';
            }

            // Show game over modal
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalDistance').textContent = distance;
            document.getElementById('finalCoins').textContent = coins;
            document.getElementById('finalHighScore').textContent = highScore;
            document.getElementById('gameOverModal').style.display = 'block';
        }

        // Restart game
        function restartGame() {
            document.getElementById('gameOverModal').style.display = 'none';
            startGame();
        }

        // Input handlers
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && gameRunning) {
                e.preventDefault();
                jump();
            }
        });

        canvas.addEventListener('click', () => {
            if (gameRunning) {
                jump();
            }
        });

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (gameRunning) {
                jump();
            }
        });

        // Initialize
        initBackground();
        draw();
    </script>
</body>
</html>